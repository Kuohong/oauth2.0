<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.power4j.oauth2.dao.RoleDao">
        <resultMap id="role" type="com.power4j.oauth2.common.pojo.Role">
                <result column="id" property="id" jdbcType="INTEGER" />
                <result column="uuid" property="uuid" jdbcType="VARCHAR" />
                <result column="key" property="key" jdbcType="VARCHAR"/>
                <result column="role_name" property="roleName" jdbcType="VARCHAR"/>
                <result column="status" property="status" typeHandler="com.power4j.oauth2.mybatis.handler.CommonStatusHandler" />
                <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
        </resultMap>
        <sql id="Base_Column_List" >
                id, uuid, key, role_name, status, create_time
        </sql>
        <insert id="saveRole" parameterType="com.power4j.oauth2.common.pojo.Role">
           insert into sys_role (uuid, key, role_name, status,create_time)
           values (#{uuid}, #{key}, #{roleName}, #{status, typeHandler=com.power4j.oauth2.mybatis.handler.CommonStatusHandler}, #{createTime})
        </insert>
        <select id="selectByUUID"  resultMap="role">
          SELECT
          <include refid="Base_Column_List"/>
          FROM sys_role
          WHERE uuid = #{uuid}
        </select>
        <select id="selectByUserUUID" resultMap="role">
                SELECT
               r.id, r.uuid, r.key, r.role_name, r.status, r.create_time
                FROM sys_role r right join sys_user_role ur on u.role_uuid = r.uuid
                WHERE ur.uuid = #{uuid}  AND r.status = <![CDATA[3]]>
        </select>
    <select id="selectAll" resultMap="role">
        SELECT
        <include refid="Base_Column_List"/>
        FROM sys_role
    </select>
    <select id="selectAllEnabled" resultMap="role">
        SELECT
        <include refid="Base_Column_List"/>
        FROM sys_role where status =#{status, typeHandler=com.power4j.oauth2.mybatis.handler.CommonStatusHandler}
    </select>
    <select id="selectRoleUUIDByUserUUID" resultType="STRING">
        SELECT ur.role_uuid
        FROM sys_user_role ur LEFT JOIN sys_role r ON r.uuid = ur.role_uuid
        WHERE user_uuid = #{uuid} AND r.status = <![CDATA[3]]>
    </select>
        <delete id="delete">
            DELETE FROM sys_role
            where  uuid = #{uuid}
        </delete>

</mapper>
